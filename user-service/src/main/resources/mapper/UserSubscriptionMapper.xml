<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.qingboat.us.dao.UserSubscriptionDao">
    <select id="getUserIdsByCreatorId" resultType="com.qingboat.us.DTO.SubscriptionAndFollowDTO">
        select distinct t.id as id,max(created_at) createTime from (select subscriber_id as id,created_at from apps_usersubscription
        where creator_id = #{creatorId} and TIMESTAMPDIFF(second,cast(NOW() as datetime),expire_date) > 0 and TIMESTAMPDIFF(second,cast(NOW() as datetime),start_date) &lt; 0
        union all
        select user_id as id,created_at from apps_followpathway where timestampdiff(second,cast(now() as datetime),expire_date) > 0 and pathway_id in ( select id from apps_pathway where author_id = #{creatorId}) )t
        group by t.id
        order by createTime desc
    </select>
</mapper>